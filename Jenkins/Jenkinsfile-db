pipeline {
  agent any
  parameters {
    string(name: 'projectName', defaultValue: 'psapp', description: 'Project name to create or target for update')
  }

  stages {
    stage('Create project') {
      steps {
        dir('openshift') {
          sh """oc login https://localhost:8443 --username developer --password developer --insecure-skip-tls-verify=true"
                if ! oc project ${projectName}
                then
            oc new-project ${projectName}
                fi"""
        }
      }
    }
    stage('Build database docker image') {
      steps {
        dir('openshift') {
        sh """oc login https://localhost:8443 --username developer --password developer --insecure-skip-tls-verify=true"
              oc apply -f database-imagestream.yaml
              oc apply -f database-build.yaml
              oc apply -f db-data-persistentvolumeclaim.yaml"""
        }
      }
    }
    stage('Deploy Container To Openshift') {
      steps {
        dir('openshift') {
        sh "oc login https://localhost:8443 --username developer --password developer --insecure-skip-tls-verify=true"
            oc apply -f database-deploymentconfig.yaml"""
        }
      }
    }
  }
}
